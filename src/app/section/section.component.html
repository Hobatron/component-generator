<div class="section-page">
  <header class="section-header">
    <div class="breadcrumb">
      <a routerLink="/" class="breadcrumb-link">Home</a>
      <span class="breadcrumb-separator">‚Ä∫</span>
      <a [routerLink]="'/projects/' + (projectName$ | async)" class="breadcrumb-link">
        {{ projectName$ | async | titlecase }}
      </a>
      <span class="breadcrumb-separator">‚Ä∫</span>
      <span class="breadcrumb-current">{{ sectionName$ | async | titlecase }}</span>
    </div>

    <div class="section-title-area">
      <h1 class="section-title">
        @if (currentSchema(); as schema) {
        <span class="section-icon">{{ schema.icon }}</span>
        {{ schema.name }}
        } @else {
        <span class="section-icon">üìÅ</span>
        {{ sectionName$ | async | titlecase }}
        }
      </h1>
      <p class="section-description">
        @if (currentSchema(); as schema) { Manage {{ schema.name }} for
        {{ projectName$ | async | titlecase }} } @else { Manage {{ sectionName$ | async }} for
        {{ projectName$ | async | titlecase }}
        }
      </p>
    </div>

    <div class="section-actions">
      @if (hasWriteAccess()) {
      <button class="action-button primary" (click)="openAddModal()">
        <span class="button-icon">‚ûï</span>
        @if (currentSchema(); as schema) { Add New {{ schema.name }} } @else { Add New
        {{ sectionName$ | async | titlecase }}
        }
      </button>
      }
      <div class="export-dropdown">
        <button class="action-button secondary" (click)="toggleExportMenu()">
          <span class="button-icon">üì§</span>
          Export
        </button>
        @if (isExportMenuOpen()) {
        <div class="export-menu">
          <button class="export-option" (click)="exportJSON()">üìÑ Export as JSON</button>
          <button class="export-option" (click)="exportImages()">üñºÔ∏è Export as Images</button>
        </div>
        }
      </div>
    </div>
  </header>

  <main class="section-content">
    <div class="items-grid">
      @for (item of sectionItems$ | async; track item['id']) {
      <div class="item-card">
        <div class="item-header">
          <h3 class="item-title">
            @if (item['name']) {
            {{ item['name'] }}
            } @else if (currentSchema(); as schema) {
            {{ schema.name }} #{{ item['id'] }}
            } @else { Unnamed Item }
          </h3>
          @if (hasWriteAccess()) {
          <div class="item-actions">
            <button class="item-action-btn edit" title="Edit" (click)="openEditModal(item)">
              ‚úèÔ∏è
            </button>
            <button class="item-action-btn delete" title="Delete">üóëÔ∏è</button>
          </div>
          }
        </div>

        <div class="item-content">
          <p class="item-description">
            {{ item['rules'] || 'No rules available' }}
          </p>

          <div class="item-tags">
            @if (item['type']) {
            <span class="item-tag type">{{ item['type'] }}</span>
            } @if (item['cost']) {
            <span class="item-tag cost">Cost: {{ item['cost'] }}</span>
            } @if (item['slot']) {
            <span class="item-tag slot">Slot: {{ item['slot'] }}</span>
            }
          </div>
        </div>

        <div class="item-footer">
          <span class="item-meta">ID: {{ item['id'] }}</span>
        </div>
      </div>
      } @empty {
      <div class="empty-state">
        <div class="empty-icon">üì≠</div>
        <h3>No {{ sectionName$ | async }} found</h3>
        <p>Get started by adding your first {{ sectionName$ | async | titlecase }}.</p>
        @if (hasWriteAccess()) {
        <button class="action-button primary" (click)="openAddModal()">
          <span class="button-icon">‚ûï</span>
          Add {{ sectionName$ | async | titlecase }}
        </button>
        }
      </div>
      }
    </div>
  </main>

  <!-- Card Edit Modal -->
  @if (currentSchema(); as schema) {
  <app-card-edit-modal
    [isOpen]="isModalOpen()"
    [item]="editingItem()"
    [schema]="schema"
    [maxId]="maxId()"
    (close)="closeModal()"
    (save)="saveItem($event)"
  />
  }
</div>
